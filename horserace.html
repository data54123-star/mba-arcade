<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Multiplayer Derby</title>
    <style>
        body {
            background-color: #1a1a1a;
            color: #fff;
            font-family: 'Courier New', monospace;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
            overflow-x: hidden;
        }

        /* --- STATUS ANZEIGE (LINKS) --- */
        #status-display {
            position: absolute; top: 15px; left: 15px;
            padding: 8px 12px; border-radius: 5px; font-weight: bold; font-size: 0.9rem;
            z-index: 1000; border: 1px solid #333; transition: all 0.3s;
        }
        .status-online { color: #00ff00; border-color: #00ff00; background: rgba(0,255,0,0.1); box-shadow: 0 0 10px rgba(0,255,0,0.2); }
        .status-offline { color: #ff0000; border-color: #ff0000; background: rgba(255,0,0,0.1); box-shadow: 0 0 10px rgba(255,0,0,0.2); }

        /* --- ACTIVE USER SIDEBAR (FIXED) --- */
        #user-sidebar {
            position: fixed; 
            top: 0; 
            right: -320px; 
            width: 250px; 
            height: 100vh;
            background: rgba(0, 0, 0, 0.95);
            border-left: 2px solid transparent; /* WICHTIG: Transparent wenn zu */
            z-index: 2000;
            transition: right 0.3s ease-in-out, border-color 0.3s;
            padding: 20px; 
            box-shadow: none; 
            overflow-y: auto;
        }
        #user-sidebar.open { 
            right: 0; 
            border-left: 2px solid #00ff00; /* Gr√ºn wenn offen */
            box-shadow: -5px 0 20px rgba(0, 255, 0, 0.2); 
        }

        .sidebar-header { font-size: 1.2rem; color: #00ff00; border-bottom: 1px dashed #00ff00; padding-bottom: 10px; margin-bottom: 20px; display: flex; justify-content: space-between; align-items: center; }
        .close-btn { cursor: pointer; font-size: 1.5rem; }
        .user-list-item { display: flex; align-items: center; gap: 10px; padding: 10px; border-bottom: 1px solid #333; animation: fadeIn 0.3s; }
        .user-list-avatar { width: 30px; height: 30px; border-radius: 50%; border: 1px solid #666; object-fit: cover; }
        .online-dot { width: 8px; height: 8px; background: #00ff00; border-radius: 50%; box-shadow: 0 0 5px #00ff00; }

        /* FLOATING BUTTON */
        #toggle-users-btn {
            position: fixed; bottom: 20px; right: 20px;
            background: #000; color: #00ff00; border: 2px solid #00ff00;
            padding: 15px; border-radius: 50%; width: 60px; height: 60px;
            font-size: 1.5rem; cursor: pointer; z-index: 1900;
            box-shadow: 0 0 15px rgba(0, 255, 0, 0.3); display: flex; justify-content: center; align-items: center; transition: all 0.2s;
        }
        #toggle-users-btn:hover { transform: scale(1.1); background: #111; }
        .badge-count { position: absolute; top: -5px; right: -5px; background: red; color: white; font-size: 0.8rem; font-weight: bold; padding: 2px 6px; border-radius: 10px; border: 1px solid white; }

        /* GAME LAYOUT */
        .view-section { display: none; width: 100%; max-width: 800px; flex-direction: column; align-items: center; }
        .active { display: flex; }
        .card-row { display: flex; justify-content: center; gap: 10px; margin-bottom: 20px; flex-wrap: wrap; }
        .card { width: 60px; height: 90px; border-radius: 5px; display: flex; justify-content: center; align-items: center; font-size: 1.5rem; background: white; color: black; font-weight: bold; box-shadow: 2px 2px 5px rgba(0,0,0,0.5); position: relative; }
        .card.red { color: red; } .card.black { color: black; }
        .track-container { display: flex; flex-direction: column; gap: 10px; width: 100%; margin-bottom: 20px; position: relative; }
        .track-lane { display: flex; align-items: center; border-bottom: 1px solid #444; padding: 5px 0; position: relative; height: 60px; }
        .horse-marker { font-size: 2rem; transition: left 0.5s ease-in-out; position: absolute; }
        .penalty-card { width: 40px; height: 60px; border: 1px solid #666; border-radius: 4px; display: flex; justify-content: center; align-items: center; font-size: 0.8rem; background: #222; color: #fff; margin-left: 5px; position: absolute; }
        .penalty-card.revealed { background: white; color: inherit; font-size: 1.2rem; }
        .finish-line { position: absolute; right: 20px; top: 0; bottom: 0; width: 4px; background-color: #fff; z-index: 0; }
        
        button { margin-top: 15px; padding: 12px 24px; font-size: 1rem; cursor: pointer; background: #333; color: white; border: 1px solid #666; font-family: inherit; font-weight: bold; }
        button:hover { background: #444; border-color: white; }
        
        .bet-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; width: 100%; margin-bottom: 20px; }
        .bet-option { background: #222; border: 2px solid #444; padding: 15px; text-align: center; cursor: pointer; border-radius: 8px; font-size: 1.2rem; }
        .bet-option:hover { background: #333; }
        .bet-option.selected { border-color: #00ff00; background: #002200; box-shadow: 0 0 10px #00ff00; }

        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        /* --- MOBILE FIXES --- */
        @media (max-width: 600px) {
            /* Home Button verschieben */
            #home-btn {
                top: 60px !important;
                left: 15px !important;
            }
            /* √úberschrift verschieben */
            h1 {
                margin-top: 100px;
            }
        }
    </style>
</head>
<body>

    <button id="home-btn" onclick="window.location.href='lobby.html'" style="
        position: absolute; top: 15px; left: 120px; 
        background: #000; color: #00ff00; border: 1px solid #00ff00; 
        padding: 8px 12px; border-radius: 5px; cursor: pointer; 
        font-family: 'Courier New', monospace; font-weight: bold; z-index: 1000;">
        üè† HOME
    </button>

    <div id="status-display" class="status-online">ONLINE üü¢</div>

    <div id="toggle-users-btn" onclick="toggleSidebar()">üë•<span id="active-user-count" class="badge-count">0</span></div>
    <div id="user-sidebar">
        <div class="sidebar-header"><span>COMM-LINK</span><span class="close-btn" onclick="toggleSidebar()">‚úñ</span></div>
        <div id="user-list-container"><small style="color:#666">Suche Signale...</small></div>
    </div>

    <h1>üêé DERBY</h1>
    <h3 id="lobby-status">Lade Lobby...</h3>

    <div id="view-lobby-list" class="view-section active">
        <p>W√§hle eine Rennbahn oder erstelle eine neue:</p>
        <button onclick="createNewLobby()">üÜï Neue Lobby erstellen</button>
        <div id="lobbies-container" style="width: 100%; margin-top: 20px;"></div>
    </div>

    <div id="view-betting" class="view-section">
        <h3>Platziere deine Wette!</h3>
        <p>Welches Ass gewinnt das Rennen?</p>
        <div class="bet-grid">
            <div class="bet-option" onclick="selectBet('‚ô¶')">‚ô¶ Karo</div>
            <div class="bet-option" onclick="selectBet('‚ô•')">‚ô• Herz</div>
            <div class="bet-option" onclick="selectBet('‚ô†')">‚ô† Pik</div>
            <div class="bet-option" onclick="selectBet('‚ô£')">‚ô£ Kreuz</div>
        </div>
        <button id="btn-place-bet" style="display:none;" onclick="placeBet()">Wette best√§tigen</button>
    </div>

    <div id="view-waiting" class="view-section">
        <h3>Warte auf Start...</h3>
        <p>Der Host mischt die Karten.</p>
        <div id="player-list-display"></div>
        <div id="host-controls" style="display:none; border-top: 1px solid #444; margin-top: 20px; padding-top: 10px;">
            <p style="color: #00ff00;">Du bist der Host!</p>
            <button onclick="hostStartGame()">Rennen starten üèÅ</button>
        </div>
    </div>

    <div id="view-race" class="view-section">
        <div class="track-container" id="track"></div>
        <div id="host-draw-controls" style="display:none; text-align: center;">
            <div style="margin-bottom: 10px; font-size: 1.2rem;">Letzte Karte: <span id="last-card-display">-</span></div>
            <button onclick="hostDrawCard()" style="font-size: 1.2rem; padding: 20px; width: 100%;">KARTEN ZIEHEN üÉè</button>
        </div>
    </div>

    <div id="view-result" class="view-section">
        <h2 style="color: #00ff00; text-shadow: 0 0 10px #00ff00;">ERGEBNIS</h2>
        <div id="result-list" style="width: 100%;"></div>
        <button onclick="backToLobby()" style="margin-top: 30px; border-color: #00ff00; color: #00ff00;">ZUR√úCK ZUR LOBBY</button>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, addDoc, doc, onSnapshot, query, where, getDocs, updateDoc, setDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
        import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

        const firebaseConfig = {
            apiKey: "AIzaSyASbziojAan2xJ3EoJ0RDPa9jh1Z-5UGX0",
            authDomain: "mba-arcade.firebaseapp.com",
            projectId: "mba-arcade",
            storageBucket: "mba-arcade.firebasestorage.app",
            messagingSenderId: "497628563783",
            appId: "1:497628563783:web:a6a0a272fb97b60bbf6462"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);

        let currentLobbyId = null;
        let playerName = "Gast";
        let myBet = null;
        let isHost = false;

        // --- GLOBAL UI ---
        function updateOnlineStatus() {
            const statusEl = document.getElementById('status-display');
            if (navigator.onLine) { statusEl.innerText = "ONLINE üü¢"; statusEl.className = "status-online"; } 
            else { statusEl.innerText = "OFFLINE üî¥"; statusEl.className = "status-offline"; }
        }
        window.addEventListener('online', updateOnlineStatus);
        window.addEventListener('offline', updateOnlineStatus);
        updateOnlineStatus();

        window.toggleSidebar = function() {
            document.getElementById('user-sidebar').classList.toggle('open');
        }

        // --- PRESENCE SYSTEM ---
        function startPresenceSystem(userEmail, userName) {
            const updateHeartbeat = async () => {
                const currentAvatar = localStorage.getItem('mba_avatar') || "100.jpg";
                await setDoc(doc(db, "online_status", userEmail), {
                    name: userName, avatar: currentAvatar, last_seen: new Date().getTime()
                });
            };
            updateHeartbeat();
            setInterval(updateHeartbeat, 30000);

            const q = query(collection(db, "online_status"));
            onSnapshot(q, (snapshot) => {
                const listContainer = document.getElementById('user-list-container');
                const badge = document.getElementById('active-user-count');
                const now = new Date().getTime();
                const timeout = 2 * 60 * 1000;
                let activeUsers = [];
                snapshot.forEach(doc => {
                    const data = doc.data();
                    if (now - data.last_seen < timeout) activeUsers.push(data);
                });
                activeUsers.sort((a,b) => a.name.localeCompare(b.name));
                badge.innerText = activeUsers.length;
                if(activeUsers.length === 0) { listContainer.innerHTML = '<div style="color:#666; padding:10px;">Keine aktiven Signale.</div>'; return; }
                let html = "";
                activeUsers.forEach(u => {
                    const isMe = (u.name === userName);
                    const style = isMe ? "border-color:#00ff00; background: #002200;" : "";
                    html += `<div class="user-list-item" style="${style}"><img src="${u.avatar}" class="user-list-avatar"><div style="flex:1;"><div style="font-weight:bold; color:white;">${u.name} ${isMe ? '(Du)' : ''}</div><div style="font-size:0.7rem; color:#00ff00;">Online</div></div><div class="online-dot"></div></div>`;
                });
                listContainer.innerHTML = html;
            });
        }

        // --- AUTH ---
        onAuthStateChanged(auth, (user) => {
            if (user) {
                playerName = user.email.replace("@mba-arcade.com", "");
                document.getElementById('lobby-status').innerText = "Hallo " + playerName;
                initLobbyList();
                startPresenceSystem(user.email, playerName); // Start Sidebar
            } else {
                window.location.href = "index.html";
            }
        });

        // --- LOBBY LIST ---
        function initLobbyList() {
            const q = query(collection(db, "lobbies"), where("status", "==", "waiting"));
            onSnapshot(q, (snapshot) => {
                const container = document.getElementById('lobbies-container');
                container.innerHTML = "";
                if(snapshot.empty) { container.innerHTML = "<p>Keine offenen Lobbys.</p>"; return; }
                snapshot.forEach(doc => {
                    const data = doc.data();
                    const btn = document.createElement('button');
                    btn.innerText = `Lobby von ${data.host} beitreten`;
                    btn.style.width = "100%";
                    btn.style.marginBottom = "10px";
                    btn.onclick = () => joinLobby(doc.id);
                    container.appendChild(btn);
                });
            });
        }

        window.createNewLobby = async function() {
            const lobbyData = {
                host: playerName,
                status: "waiting",
                players: [], 
                gameState: null,
                createdAt: new Date()
            };
            const docRef = await addDoc(collection(db, "lobbies"), lobbyData);
            joinLobby(docRef.id);
        }

        async function joinLobby(lobbyId) {
            currentLobbyId = lobbyId;
            switchView('view-betting');
            
            // Subscribe to Lobby Updates
            onSnapshot(doc(db, "lobbies", currentLobbyId), (doc) => {
                if(!doc.exists()) return;
                const data = doc.data();
                
                // Check Host
                isHost = (data.host === playerName);
                if(isHost) document.getElementById('host-controls').style.display = 'block';

                // Player List update
                const pList = document.getElementById('player-list-display');
                if(data.players) {
                    pList.innerHTML = "<h4>Spieler:</h4>" + data.players.map(p => `<div>${p.name} (Wettet auf ${p.betSuit})</div>`).join("");
                }

                // Game Started?
                if(data.status === "racing" && document.getElementById('view-race').style.display === "none") {
                    startRaceView(data);
                }
                
                // Update Race State
                if(data.status === "racing") {
                    updateRaceVisuals(data.gameState);
                }

                // Finished?
                if(data.status === "finished") {
                    showResults(data);
                }
            });
        }

        // --- BETTING ---
        window.selectBet = function(suit) {
            myBet = suit;
            document.querySelectorAll('.bet-option').forEach(el => el.classList.remove('selected'));
            event.target.classList.add('selected');
            document.getElementById('btn-place-bet').style.display = 'inline-block';
        }

        window.placeBet = async function() {
            if(!myBet) return;
            // Add player to lobby
            const lobbyRef = doc(db, "lobbies", currentLobbyId);
            const snap = await getDocs(query(collection(db, "lobbies"), where("__name__", "==", currentLobbyId))); // Quick read to get current array
            // Note: In real app use arrayUnion or transaction. Here we append to local copy for simplicity via update
            // Correct way: use arrayUnion. 
            // Since we can't import arrayUnion easily without full SDK config changes, we do a read-modify-write (risk of race condition but ok for small groups)
            
            // Let's rely on simple update for now, hoping no concurrent writes
            const data = snap.docs[0].data();
            const newPlayers = data.players || [];
            // Remove if already exists
            const filtered = newPlayers.filter(p => p.name !== playerName);
            filtered.push({ name: playerName, betSuit: myBet, payout: 0 });
            
            await updateDoc(lobbyRef, { players: filtered });
            switchView('view-waiting');
        }

        // --- HOST LOGIC ---
        window.hostStartGame = async function() {
            // Deck Setup
            const deck = createDeck();
            const gameState = {
                deck: deck,
                positions: { '‚ô¶': 0, '‚ô•': 0, '‚ô†': 0, '‚ô£': 0 },
                penaltyCards: [deck.pop(), deck.pop(), deck.pop(), deck.pop(), deck.pop(), deck.pop(), deck.pop()],
                penaltyRevealed: [false, false, false, false, false, false, false],
                finishedOrder: [],
                lastDrawnCard: null
            };

            await updateDoc(doc(db, "lobbies", currentLobbyId), {
                status: "racing",
                gameState: gameState
            });
        }

        window.hostDrawCard = async function() {
            const snap = await getDocs(query(collection(db, "lobbies"), where("__name__", "==", currentLobbyId)));
            const data = snap.docs[0].data();
            const gs = data.gameState;

            if(gs.deck.length === 0) gs.deck = createDeck(); // Safety refill

            const card = gs.deck.pop();
            gs.lastDrawnCard = card;

            // Move
            if(!gs.finishedOrder.includes(card.suit)) {
                gs.positions[card.suit]++;
            }

            // Finish check
            if(gs.positions[card.suit] >= 8 && !gs.finishedOrder.includes(card.suit)) {
                gs.finishedOrder.push(card.suit);
                gs.positions[card.suit] = 8; 
            }

            // Penalty Logic
            const minPos = Math.min(gs.positions['‚ô¶'], gs.positions['‚ô•'], gs.positions['‚ô†'], gs.positions['‚ô£']);
            
            for(let i=0; i<7; i++) {
                if(minPos >= (i+1) && !gs.penaltyRevealed[i]) {
                    gs.penaltyRevealed[i] = true;
                    const pCard = gs.penaltyCards[i];
                    if(!gs.finishedOrder.includes(pCard.suit)) {
                        gs.positions[pCard.suit]--;
                    }
                }
            }

            // GAME END CHECK (3 Pferde im Ziel = Ende)
            if(gs.finishedOrder.length === 3) {
                const allSuits = ['‚ô¶', '‚ô•', '‚ô†', '‚ô£'];
                const loser = allSuits.find(s => !gs.finishedOrder.includes(s));
                gs.finishedOrder.push(loser);
                calculateResults(data.players, gs.finishedOrder); 
                return; 
            }

            await updateDoc(doc(db, "lobbies", currentLobbyId), { gameState: gs });
        }

        async function calculateResults(players, order) {
            // Payouts: 1st=2x, 2nd=1x, 3rd=-1x, 4th=-2x (Strafschlucke)
            const updatedPlayers = players.map(p => {
                let payout = 0;
                let text = "";
                if(p.betSuit === order[0]) { payout = 2; text = "SIEG! (Verteilen: 2x)"; }
                else if(p.betSuit === order[1]) { payout = 1; text = "Platz 2 (Verteilen: 1x)"; }
                else if(p.betSuit === order[2]) { payout = -1; text = "Platz 3 (Trinken: 1x)"; }
                else { payout = -2; text = "LETZTER! (Trinken: 2x)"; }
                return { ...p, payout: payout, resultText: text };
            });

            await updateDoc(doc(db, "lobbies", currentLobbyId), {
                players: updatedPlayers,
                status: "finished",
                "gameState.finishedOrder": order // Save final order
            });
        }


        // --- VISUALS ---
        function startRaceView(data) {
            switchView('view-race');
            if(isHost) document.getElementById('host-draw-controls').style.display = 'block';
            renderTrack();
        }

        function renderTrack() {
            const container = document.getElementById('track');
            container.innerHTML = "";
            const suits = ['‚ô¶', '‚ô•', '‚ô†', '‚ô£'];
            
            // Finish line marker
            const line = document.createElement('div');
            line.className = 'finish-line';
            line.style.left = (8 * 11 + 20) + '%'; // Approx
            // container.appendChild(line); // CSS line is better

            suits.forEach(suit => {
                const lane = document.createElement('div');
                lane.className = 'track-lane';
                lane.id = `lane-${suit}`;
                
                const horse = document.createElement('div');
                horse.className = 'horse-marker';
                horse.innerText = suit === '‚ô¶' || suit === '‚ô•' ? suit + 'üü•' : suit + '‚¨õ'; // Color emoji hack
                horse.style.color = suit === '‚ô¶' || suit === '‚ô•' ? '#ff4444' : '#fff';
                horse.id = `horse-${suit}`;
                horse.style.left = '0%';
                
                lane.appendChild(horse);
                container.appendChild(lane);
            });
            
            // Penalty Cards Row (Visual hack: extra lane or positioned absolute)
            // Simplified: Just render penalty cards below track? No, usually on the side.
            // Let's render markers on the track for penalties
            for(let i=0; i<7; i++) {
                const marker = document.createElement('div');
                marker.className = 'penalty-card';
                marker.id = `penalty-${i}`;
                marker.innerText = "?";
                marker.style.left = ((i+1) * 11) + '%'; 
                marker.style.top = '250px'; // Below lanes
                container.appendChild(marker);
            }
        }

        function updateRaceVisuals(gs) {
            const suits = ['‚ô¶', '‚ô•', '‚ô†', '‚ô£'];
            suits.forEach(suit => {
                const pos = gs.positions[suit];
                const el = document.getElementById(`horse-${suit}`);
                if(el) el.style.left = (pos * 11) + '%';
            });

            // Update Penalties
            for(let i=0; i<7; i++) {
                const el = document.getElementById(`penalty-${i}`);
                if(el) {
                    if(gs.penaltyRevealed[i]) {
                        const card = gs.penaltyCards[i];
                        el.className = 'penalty-card revealed';
                        el.innerText = card.value + card.suit;
                        el.style.color = (card.suit === '‚ô¶' || card.suit === '‚ô•') ? 'red' : 'black';
                    }
                }
            }
            
            // Last Card
            if(gs.lastDrawnCard) {
                const lc = gs.lastDrawnCard;
                const disp = document.getElementById('last-card-display');
                disp.innerText = lc.value + lc.suit;
                disp.style.color = (lc.suit === '‚ô¶' || lc.suit === '‚ô•') ? '#ff4444' : '#fff';
            }
        }

        function showResults(data) {
            document.getElementById('view-race').classList.remove('active');
            document.getElementById('view-result').classList.add('active');
            const list = document.getElementById('result-list');
            
            // SAFETY FIX: Fehlende Pferde auff√ºllen
            let order = data.gameState.finishedOrder || [];
            const allSuits = ['‚ô¶', '‚ô•', '‚ô†', '‚ô£'];
            const missing = allSuits.filter(suit => !order.includes(suit));
            const finalOrder = [...order, ...missing];

            let html = `<div style="margin-bottom:20px; padding:10px; border:1px solid #444; border-radius:5px;">
                <h3>Zieleinlauf</h3>
                <div style="display:flex; justify-content:space-around; font-size:1.5rem;">
                    <div style="display:flex; flex-direction:column; align-items:center;">
                        <span style="font-size:0.8rem; color:#ffd700;">1. Platz</span>
                        <span>ü•á ${finalOrder[0]}</span>
                    </div>
                    <div style="display:flex; flex-direction:column; align-items:center;">
                        <span style="font-size:0.8rem; color:#c0c0c0;">2. Platz</span>
                        <span>ü•à ${finalOrder[1]}</span>
                    </div>
                    <div style="display:flex; flex-direction:column; align-items:center;">
                        <span style="font-size:0.8rem; color:#cd7f32;">3. Platz</span>
                        <span>ü•â ${finalOrder[2]}</span>
                    </div>
                    <div style="display:flex; flex-direction:column; align-items:center;">
                        <span style="font-size:0.8rem; color:#ff4444;">Vierter</span>
                        <span>üíÄ ${finalOrder[3]}</span>
                    </div>
                </div>
            </div>
            <h3>Bilanz</h3>`;
            
            data.players.forEach(p => {
                let col = p.payout > 0 ? "#00ff00" : (p.payout < 0 ? "#ff0000" : "#fff");
                html += `<div style="display:flex; justify-content:space-between; padding:10px; border-bottom:1px solid #333;">
                    <span>${p.name} (${p.betSuit})</span>
                    <div style="text-align:right;"><div style="font-weight:bold; color:${col}">${p.payout>0?'+':''}${p.payout}</div><small>${p.resultText}</small></div>
                </div>`;
            });
            list.innerHTML = html;
        }

        window.backToLobby = function() {
            window.location.href = "lobby.html";
        }

        // --- UTILS ---
        function switchView(id) {
            document.querySelectorAll('.view-section').forEach(el => el.classList.remove('active'));
            document.getElementById(id).classList.add('active');
        }

        function createDeck() {
            const suits = ['‚ô¶', '‚ô•', '‚ô†', '‚ô£'];
            const values = ['2','3','4','5','6','7','8','9','10','J','Q','K','A'];
            let deck = [];
            for(let s of suits) {
                for(let v of values) {
                    deck.push({ suit: s, value: v });
                }
            }
            return shuffle(deck);
        }

        function shuffle(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }
    </script>
</body>
</html>